var Ne=Object.create;var Z=Object.defineProperty;var Fe=Object.getOwnPropertyDescriptor;var Me=Object.getOwnPropertyNames;var He=Object.getPrototypeOf,Xe=Object.prototype.hasOwnProperty;var R=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var je=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Me(e))!Xe.call(t,i)&&i!==n&&Z(t,i,{get:()=>e[i],enumerable:!(r=Fe(e,i))||r.enumerable});return t};var We=(t,e,n)=>(n=t!=null?Ne(He(t)):{},je(e||!t||!t.__esModule?Z(n,"default",{value:t,enumerable:!0}):n,t));var Se=R((Dt,Ee)=>{var T;typeof window!="undefined"?T=window:typeof global!="undefined"?T=global:typeof self!="undefined"?T=self:T={};Ee.exports=T});var Re=R((Lt,we)=>{we.exports=ht;var ct=Object.prototype.toString;function ht(t){if(!t)return!1;var e=ct.call(t);return e==="[object Function]"||typeof t=="function"&&e!=="[object RegExp]"||typeof window!="undefined"&&(t===window.setTimeout||t===window.alert||t===window.confirm||t===window.prompt)}});var ze=R((Bt,Te)=>{var V=function(t){return t.replace(/^\s+|\s+$/g,"")},pt=function(t){return Object.prototype.toString.call(t)==="[object Array]"};Te.exports=function(t){if(!t)return{};for(var e={},n=V(t).split(`
`),r=0;r<n.length;r++){var i=n[r],a=i.indexOf(":"),o=V(i.slice(0,a)).toLowerCase(),s=V(i.slice(a+1));typeof e[o]=="undefined"?e[o]=s:pt(e[o])?e[o].push(s):e[o]=[e[o],s]}return e}});var Ae=R((xt,Pe)=>{Pe.exports=ft;var dt=Object.prototype.hasOwnProperty;function ft(){for(var t={},e=0;e<arguments.length;e++){var n=arguments[e];for(var r in n)dt.call(n,r)&&(t[r]=n[r])}return t}});var Ie=R((Nt,$)=>{"use strict";var Oe=Se(),mt=Re(),bt=ze(),gt=Ae();$.exports=y;$.exports.default=y;y.XMLHttpRequest=Oe.XMLHttpRequest||kt;y.XDomainRequest="withCredentials"in new y.XMLHttpRequest?y.XMLHttpRequest:Oe.XDomainRequest;yt(["get","put","post","patch","head","delete"],function(t){y[t==="delete"?"del":t]=function(e,n,r){return n=_e(e,n,r),n.method=t.toUpperCase(),Ue(n)}});function yt(t,e){for(var n=0;n<t.length;n++)e(t[n])}function Ct(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}function _e(t,e,n){var r=t;return mt(e)?(n=e,typeof t=="string"&&(r={uri:t})):r=gt(e,{uri:t}),r.callback=n,r}function y(t,e,n){return e=_e(t,e,n),Ue(e)}function Ue(t){if(typeof t.callback=="undefined")throw new Error("callback argument missing");var e=!1,n=function(k,O,xe){e||(e=!0,t.callback(k,O,xe))};function r(){s.readyState===4&&setTimeout(o,0)}function i(){var l=void 0;if(s.response?l=s.response:l=s.responseText||vt(s),x)try{l=JSON.parse(l)}catch{}return l}function a(l){return clearTimeout(N),l instanceof Error||(l=new Error(""+(l||"Unknown XMLHttpRequest Error"))),l.statusCode=0,n(l,K)}function o(){if(!h){var l;clearTimeout(N),t.useXDR&&s.status===void 0?l=200:l=s.status===1223?204:s.status;var k=K,O=null;return l!==0?(k={body:i(),statusCode:l,method:m,headers:{},url:g,rawRequest:s},s.getAllResponseHeaders&&(k.headers=bt(s.getAllResponseHeaders()))):O=new Error("Internal XMLHttpRequest Error"),n(O,k,k.body)}}var s=t.xhr||null;s||(t.cors||t.useXDR?s=new y.XDomainRequest:s=new y.XMLHttpRequest);var u,h,g=s.url=t.uri||t.url,m=s.method=t.method||"GET",v=t.body||t.data,b=s.headers=t.headers||{},A=!!t.sync,x=!1,N,K={body:void 0,headers:{},statusCode:0,method:m,url:g,rawRequest:s};if("json"in t&&t.json!==!1&&(x=!0,b.accept||b.Accept||(b.Accept="application/json"),m!=="GET"&&m!=="HEAD"&&(b["content-type"]||b["Content-Type"]||(b["Content-Type"]="application/json"),v=JSON.stringify(t.json===!0?v:t.json))),s.onreadystatechange=r,s.onload=o,s.onerror=a,s.onprogress=function(){},s.onabort=function(){h=!0},s.ontimeout=a,s.open(m,g,!A,t.username,t.password),A||(s.withCredentials=!!t.withCredentials),!A&&t.timeout>0&&(N=setTimeout(function(){if(!h){h=!0,s.abort("timeout");var l=new Error("XMLHttpRequest timeout");l.code="ETIMEDOUT",a(l)}},t.timeout)),s.setRequestHeader)for(u in b)b.hasOwnProperty(u)&&s.setRequestHeader(u,b[u]);else if(t.headers&&!Ct(t.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in t&&(s.responseType=t.responseType),"beforeSend"in t&&typeof t.beforeSend=="function"&&t.beforeSend(s),s.send(v||null),s}function vt(t){try{if(t.responseType==="document")return t.responseXML;var e=t.responseXML&&t.responseXML.documentElement.nodeName==="parsererror";if(t.responseType===""&&!e)return t.responseXML}catch{}return null}function kt(){}});function W(t,e,...n){if(!t)throw new TypeError(ue(e,n))}function ue(t,e){let n=0;return t.replace(/%[os]/gu,()=>le(e[n++]))}function le(t){return typeof t!="object"||t===null?String(t):Object.prototype.toString.call(t)}var J;function Ve(t){try{let e=t instanceof Error?t:new Error(le(t));if(J){J(e);return}if(typeof dispatchEvent=="function"&&typeof ErrorEvent=="function")dispatchEvent(new ErrorEvent("error",{error:e,message:e.message}));else if(typeof process!="undefined"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)}catch{}}var p=typeof window!="undefined"?window:typeof self!="undefined"?self:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:void 0,Q;var d=class{constructor(e,n){this.code=e,this.message=n}warn(...e){var n;try{if(Q){Q({...this,args:e});return}let r=((n=new Error().stack)!==null&&n!==void 0?n:"").replace(/^(?:.+?\n){2}/gu,`
`);console.warn(this.message,...e,r)}catch{}}},$e=new d("W01","Unable to initialize event under dispatching."),qe=new d("W02","Assigning any falsy value to 'cancelBubble' property has no effect."),Ge=new d("W03","Assigning any truthy value to 'returnValue' property has no effect."),Ye=new d("W04","Unable to preventDefault on non-cancelable events."),Ke=new d("W05","Unable to preventDefault inside passive event listener invocation."),Ze=new d("W06","An event listener wasn't added because it has been added already: %o, %o"),F=new d("W07","The %o option value was abandoned because the event listener wasn't added as duplicated."),ee=new d("W08","The 'callback' argument must be a function or an object that has 'handleEvent' method: %o"),Pt=new d("W09","Event attribute handler must be a function: %o"),f=class{static get NONE(){return te}static get CAPTURING_PHASE(){return ne}static get AT_TARGET(){return re}static get BUBBLING_PHASE(){return ie}constructor(e,n){Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});let r=n!=null?n:{};j.set(this,{type:String(e),bubbles:Boolean(r.bubbles),cancelable:Boolean(r.cancelable),composed:Boolean(r.composed),target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1,inPassiveListenerFlag:!1,dispatchFlag:!1,timeStamp:Date.now()})}get type(){return c(this).type}get target(){return c(this).target}get srcElement(){return c(this).target}get currentTarget(){return c(this).currentTarget}composedPath(){let e=c(this).currentTarget;return e?[e]:[]}get NONE(){return te}get CAPTURING_PHASE(){return ne}get AT_TARGET(){return re}get BUBBLING_PHASE(){return ie}get eventPhase(){return c(this).dispatchFlag?2:0}stopPropagation(){c(this).stopPropagationFlag=!0}get cancelBubble(){return c(this).stopPropagationFlag}set cancelBubble(e){e?c(this).stopPropagationFlag=!0:qe.warn()}stopImmediatePropagation(){let e=c(this);e.stopPropagationFlag=e.stopImmediatePropagationFlag=!0}get bubbles(){return c(this).bubbles}get cancelable(){return c(this).cancelable}get returnValue(){return!c(this).canceledFlag}set returnValue(e){e?Ge.warn():se(c(this))}preventDefault(){se(c(this))}get defaultPrevented(){return c(this).canceledFlag}get composed(){return c(this).composed}get isTrusted(){return!1}get timeStamp(){return c(this).timeStamp}initEvent(e,n=!1,r=!1){let i=c(this);if(i.dispatchFlag){$e.warn();return}j.set(this,{...i,type:String(e),bubbles:Boolean(n),cancelable:Boolean(r),target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1})}},te=0,ne=1,re=2,ie=3,j=new WeakMap;function c(t,e="this"){let n=j.get(t);return W(n!=null,"'%s' must be an object that Event constructor created, but got another one: %o",e,t),n}function se(t){if(t.inPassiveListenerFlag){Ke.warn();return}if(!t.cancelable){Ye.warn();return}t.canceledFlag=!0}Object.defineProperty(f,"NONE",{enumerable:!0});Object.defineProperty(f,"CAPTURING_PHASE",{enumerable:!0});Object.defineProperty(f,"AT_TARGET",{enumerable:!0});Object.defineProperty(f,"BUBBLING_PHASE",{enumerable:!0});var M=Object.getOwnPropertyNames(f.prototype);for(let t=0;t<M.length;++t)M[t]!=="constructor"&&Object.defineProperty(f.prototype,M[t],{enumerable:!0});typeof p!="undefined"&&typeof p.Event!="undefined"&&Object.setPrototypeOf(f.prototype,p.Event.prototype);function Je(t){return p.DOMException?new p.DOMException(t,"InvalidStateError"):(S==null&&(S=class ce extends Error{constructor(n){super(n),Error.captureStackTrace&&Error.captureStackTrace(this,ce)}get code(){return 11}get name(){return"InvalidStateError"}},Object.defineProperties(S.prototype,{code:{enumerable:!0},name:{enumerable:!0}}),oe(S),oe(S.prototype)),new S(t))}var S,ae={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};function oe(t){let e=Object.keys(ae);for(let n=0;n<e.length;++n){let r=e[n],i=ae[r];Object.defineProperty(t,r,{get(){return i},configurable:!0,enumerable:!0})}}var w=class extends f{static wrap(e){return new(pe(e))(e)}constructor(e){super(e.type,{bubbles:e.bubbles,cancelable:e.cancelable,composed:e.composed}),e.cancelBubble&&super.stopPropagation(),e.defaultPrevented&&super.preventDefault(),he.set(this,{original:e});let n=Object.keys(e);for(let r=0;r<n.length;++r){let i=n[r];i in this||Object.defineProperty(this,i,de(e,i))}}stopPropagation(){super.stopPropagation();let{original:e}=C(this);"stopPropagation"in e&&e.stopPropagation()}get cancelBubble(){return super.cancelBubble}set cancelBubble(e){super.cancelBubble=e;let{original:n}=C(this);"cancelBubble"in n&&(n.cancelBubble=e)}stopImmediatePropagation(){super.stopImmediatePropagation();let{original:e}=C(this);"stopImmediatePropagation"in e&&e.stopImmediatePropagation()}get returnValue(){return super.returnValue}set returnValue(e){super.returnValue=e;let{original:n}=C(this);"returnValue"in n&&(n.returnValue=e)}preventDefault(){super.preventDefault();let{original:e}=C(this);"preventDefault"in e&&e.preventDefault()}get timeStamp(){let{original:e}=C(this);return"timeStamp"in e?e.timeStamp:super.timeStamp}},he=new WeakMap;function C(t){let e=he.get(t);return W(e!=null,"'this' is expected an Event object, but got",t),e}var _=new WeakMap;_.set(Object.prototype,w);typeof p!="undefined"&&typeof p.Event!="undefined"&&_.set(p.Event.prototype,w);function pe(t){let e=Object.getPrototypeOf(t);if(e==null)return w;let n=_.get(e);return n==null&&(n=Qe(pe(e),e),_.set(e,n)),n}function Qe(t,e){class n extends t{}let r=Object.keys(e);for(let i=0;i<r.length;++i)Object.defineProperty(n.prototype,r[i],de(e,r[i]));return n}function de(t,e){let n=Object.getOwnPropertyDescriptor(t,e);return{get(){let r=C(this).original,i=r[e];return typeof i=="function"?i.bind(r):i},set(r){let i=C(this).original;i[e]=r},configurable:n.configurable,enumerable:n.enumerable}}function et(t,e,n,r,i,a){return{callback:t,flags:(e?1:0)|(n?2:0)|(r?4:0),signal:i,signalListener:a}}function tt(t){t.flags|=8}function fe(t){return(t.flags&1)===1}function me(t){return(t.flags&2)===2}function be(t){return(t.flags&4)===4}function nt(t){return(t.flags&8)===8}function rt({callback:t},e,n){try{typeof t=="function"?t.call(e,n):typeof t.handleEvent=="function"&&t.handleEvent(n)}catch(r){Ve(r)}}function ge({listeners:t},e,n){for(let r=0;r<t.length;++r)if(t[r].callback===e&&fe(t[r])===n)return r;return-1}function it(t,e,n,r,i,a){let o;a&&(o=ye.bind(null,t,e,n),a.addEventListener("abort",o));let s=et(e,n,r,i,a,o);return t.cow?(t.cow=!1,t.listeners=[...t.listeners,s]):t.listeners.push(s),s}function ye(t,e,n){let r=ge(t,e,n);return r!==-1?Ce(t,r):!1}function Ce(t,e,n=!1){let r=t.listeners[e];return tt(r),r.signal&&r.signal.removeEventListener("abort",r.signalListener),t.cow&&!n?(t.cow=!1,t.listeners=t.listeners.filter((i,a)=>a!==e),!1):(t.listeners.splice(e,1),!0)}function st(){return Object.create(null)}function at(t,e){var n;return(n=t[e])!==null&&n!==void 0?n:t[e]={attrCallback:void 0,attrListener:void 0,cow:!1,listeners:[]}}var E=class{constructor(){ve.set(this,st())}addEventListener(e,n,r){let i=H(this),{callback:a,capture:o,once:s,passive:u,signal:h,type:g}=ot(e,n,r);if(a==null||(h==null?void 0:h.aborted))return;let m=at(i,g),v=ge(m,a,o);if(v!==-1){lt(m.listeners[v],u,s,h);return}it(m,a,o,u,s,h)}removeEventListener(e,n,r){let i=H(this),{callback:a,capture:o,type:s}=ut(e,n,r),u=i[s];a!=null&&u&&ye(u,a,o)}dispatchEvent(e){let n=H(this)[String(e.type)];if(n==null)return!0;let r=e instanceof f?e:w.wrap(e),i=c(r,"event");if(i.dispatchFlag)throw Je("This event has been in dispatching.");if(i.dispatchFlag=!0,i.target=i.currentTarget=this,!i.stopPropagationFlag){let{cow:a,listeners:o}=n;n.cow=!0;for(let s=0;s<o.length;++s){let u=o[s];if(!nt(u)&&(be(u)&&Ce(n,s,!a)&&(s-=1),i.inPassiveListenerFlag=me(u),rt(u,this,r),i.inPassiveListenerFlag=!1,i.stopImmediatePropagationFlag))break}a||(n.cow=!1)}return i.target=null,i.currentTarget=null,i.stopImmediatePropagationFlag=!1,i.stopPropagationFlag=!1,i.dispatchFlag=!1,!i.canceledFlag}},ve=new WeakMap;function H(t,e="this"){let n=ve.get(t);return W(n!=null,"'%s' must be an object that EventTarget constructor created, but got another one: %o",e,t),n}function ot(t,e,n){var r;return ke(e),typeof n=="object"&&n!==null?{type:String(t),callback:e!=null?e:void 0,capture:Boolean(n.capture),passive:Boolean(n.passive),once:Boolean(n.once),signal:(r=n.signal)!==null&&r!==void 0?r:void 0}:{type:String(t),callback:e!=null?e:void 0,capture:Boolean(n),passive:!1,once:!1,signal:void 0}}function ut(t,e,n){return ke(e),typeof n=="object"&&n!==null?{type:String(t),callback:e!=null?e:void 0,capture:Boolean(n.capture)}:{type:String(t),callback:e!=null?e:void 0,capture:Boolean(n)}}function ke(t){if(!(typeof t=="function"||typeof t=="object"&&t!==null&&typeof t.handleEvent=="function")){if(t==null||typeof t=="object"){ee.warn(t);return}throw new TypeError(ue(ee.message,[t]))}}function lt(t,e,n,r){Ze.warn(fe(t)?"capture":"bubble",t.callback),me(t)!==e&&F.warn("passive"),be(t)!==n&&F.warn("once"),t.signal!==r&&F.warn("signal")}var X=Object.getOwnPropertyNames(E.prototype);for(let t=0;t<X.length;++t)X[t]!=="constructor"&&Object.defineProperty(E.prototype,X[t],{enumerable:!0});typeof p!="undefined"&&typeof p.EventTarget!="undefined"&&Object.setPrototypeOf(E.prototype,p.EventTarget.prototype);var U=class{constructor(){this.eventTarget=new E}dispatch(e,n){let r=new CustomEvent(e,{detail:n});this.eventTarget.dispatchEvent(r)}};var I=class{constructor(){this.paused=!1,this.offline=!1}};var De=We(Ie()),Et=[200,201,202,204,308],St=[408,502,503,504],Le=(t,e)=>!!t&&Et.includes(t.statusCode),wt=(t,{retryCodes:e=St})=>!t||e.includes(t.statusCode),Rt=(t,e)=>e.attemptCount>=e.attempts||!(Le(t)||wt(t,e)),z=class{constructor(e,n,r,i,a,o,s,u,h,g,m,v,b,A,x){this.eventDispatcher=e;this.player=n;this.endpointValue=r;this.method=i;this.headers=a;this.retryCodes=o;this.chunk=s;this.fileSize=u;this.fileType=h;this.chunkCount=g;this.chunkSize=m;this.attempts=v;this.delayBeforeAttempt=b;this.totalChunks=A;this.chunkByteSize=x;this.attemptCount=0}async sendChunkWithRetries(){let e=async(o,s)=>(this.eventDispatcher.dispatch("chunkSuccess",{chunk:this.chunkCount,chunkSize:this.chunkSize,attempts:this.attemptCount,response:o}),!0),n=async(o,s)=>(this.eventDispatcher.dispatch("error",{message:`Server responded with ${o.statusCode}. Stopping upload.`,chunk:this.chunkCount,attempts:this.attemptCount}),!1),r=async(o,s)=>(this.eventDispatcher.dispatch("attemptFailure",{message:`An error occured uploading chunk ${this.chunkCount}. ${this.attempts-this.attemptCount} retries left.`,chunkNumber:this.chunkCount,attemptsLeft:this.attempts-this.attemptCount}),new Promise(u=>{setTimeout(async()=>{if(this.player.paused||this.player.offline){u(!1);return}let h=await this.sendChunkWithRetries();u(h)},this.delayBeforeAttempt*1e3)})),i;try{this.attemptCount=this.attemptCount+1,i=await this.sendChunk(this.chunk)}catch{}let a={retryCodes:this.retryCodes,attemptCount:this.attemptCount,attempts:this.attempts};return Le(i,a)?e(i,this.chunk):Rt(i,a)?n(i,this.chunk):r(i,this.chunk)}async sendChunk(e){let r={...this.headers,"Content-Type":this.fileType,"Content-Range":`bytes ${e.rangeStart}-${e.rangeEnd}/${this.fileSize}`};return this.eventDispatcher.dispatch("attempt",{chunkNumber:this.chunkCount,totalChunks:this.totalChunks,chunkSize:this.chunkSize}),this.xhrPromise({headers:r,url:this.endpointValue,method:this.method,body:e.blob})}xhrPromise(e){let n=r=>{r.upload.onprogress=i=>{var g;let a=this.totalChunks-this.chunkCount,o=(this.fileSize-this.chunk.rangeStart)/this.fileSize/a,s=this.chunk.rangeStart/this.fileSize,h=i.loaded/((g=i.total)!=null?g:this.chunkByteSize)*o;this.eventDispatcher.dispatch("progress",Math.min((s+h)*100,100))}};return new Promise((r,i)=>{this.currentXhr=(0,De.default)({...e,beforeSend:n},(a,o)=>(this.currentXhr=void 0,a?i(a):r(o)))})}};var D=class{constructor(e,n){this.blob=e;this.rangeStart=n;this.rangeEnd=n+e.size-1}};var Be=30720,L=512e3,B=256,q=(t,{minChunkSize:e=B,maxChunkSize:n=L}={})=>t==null||typeof t=="number"&&t>=256&&t%256===0&&t>=e&&t<=n,G=(t,{minChunkSize:e=B,maxChunkSize:n=L}={})=>new TypeError(`chunkSize ${t} must be a positive number in multiples of 256, between ${e} and ${n}`),Y=class{constructor(e,n={}){this.readableStream=e;var r,i,a;if(!q(n.defaultChunkSize,n))throw G(n.defaultChunkSize,n);this.defaultChunkSize=(r=n.defaultChunkSize)!=null?r:Be,this.minChunkSize=(i=n.minChunkSize)!=null?i:B,this.maxChunkSize=(a=n.maxChunkSize)!=null?a:L}get chunkSize(){var e;return(e=this._chunkSize)!=null?e:this.defaultChunkSize}set chunkSize(e){if(!q(e,this))throw G(e,this);this._chunkSize=e}get chunkByteSize(){return this.chunkSize*1024}async*[Symbol.asyncIterator](){let e,n=this.readableStream.getReader();try{for(;;){let{done:r,value:i}=await n.read();if(r){if(e){let o=e;e=void 0,yield o}break}let a=i instanceof Uint8Array?new Blob([i],{type:"application/octet-stream"}):i;for(e=e?new Blob([e,a]):a;e;)if(e.size===this.chunkByteSize){let o=e;e=void 0,yield o;break}else{if(e.size<this.chunkByteSize)break;{let o=e.slice(0,this.chunkByteSize);e=e.slice(this.chunkByteSize),yield o}}}}finally{if(e){let r=e;e=void 0,yield r}n.releaseLock();return}}},Tt=[408,502,503,504],P=class{static createUpload(e){return new P(e)}constructor(e){this.endpoint=e.endpoint,this.file=e.file,this.headers=e.headers||{},this.method=e.method||"PUT",this.attempts=e.attempts||5,this.delayBeforeAttempt=e.delayBeforeAttempt||1,this.retryCodes=e.retryCodes||Tt,this.dynamicChunkSize=e.dynamicChunkSize||!1,this.maxFileBytes=(e.maxFileSize||0)*1024,this.chunkCount=0,this.player=new I,this.success=!1,this.nextChunkRangeStart=0,this.eventDispatcher=new U,this.ChunkUploaders=[],this.concurrentUploads=e.concurentUploads||1,this.chunkedStreamIterable=new Y(this.file.stream(),{...e,defaultChunkSize:e.chunkSize}),this.chunkedStreamIterator=this.chunkedStreamIterable[Symbol.asyncIterator](),this.totalChunks=Math.ceil(this.file.size/this.chunkByteSize),this.validateOptions(),this.getEndpoint().then(()=>this.sendChunks()),typeof window!="undefined"&&(window.addEventListener("online",()=>{!this.player.offline||(this.player.offline=!1,this.eventDispatcher.dispatch("online"),this.sendChunks())}),window.addEventListener("offline",()=>{this.player.offline=!0,this.eventDispatcher.dispatch("offline")}))}get maxChunkSize(){var e,n;return(n=(e=this.chunkedStreamIterable)==null?void 0:e.maxChunkSize)!=null?n:L}get minChunkSize(){var e,n;return(n=(e=this.chunkedStreamIterable)==null?void 0:e.minChunkSize)!=null?n:B}get chunkSize(){var e,n;return(n=(e=this.chunkedStreamIterable)==null?void 0:e.chunkSize)!=null?n:Be}set chunkSize(e){this.chunkedStreamIterable.chunkSize=e}get chunkByteSize(){return this.chunkedStreamIterable.chunkByteSize}get totalChunkSize(){return Math.ceil(this.file.size/this.chunkByteSize)}on(e,n){this.eventDispatcher.eventTarget.addEventListener(e,n)}once(e,n){this.eventDispatcher.eventTarget.addEventListener(e,n,{once:!0})}off(e,n){this.eventDispatcher.eventTarget.removeEventListener(e,n)}get paused(){return this.player.paused}abort(){this.pause(),this.ChunkUploaders.forEach(e=>{var n;return(n=e.currentXhr)==null?void 0:n.abort()})}pause(){this.player.paused=!0}resume(){this.player.paused&&(this.player.paused=!1,this.sendChunks())}validateOptions(){if(!this.endpoint||typeof this.endpoint!="function"&&typeof this.endpoint!="string")throw new TypeError("endpoint must be defined as a string or a function that returns a promise");if(!(this.file instanceof File))throw new TypeError("file must be a File object");if(this.headers&&typeof this.headers!="function"&&typeof this.headers!="object")throw new TypeError("headers must be null, an object, or a function that returns an object or a promise");if(!q(this.chunkSize,{maxChunkSize:this.maxChunkSize,minChunkSize:this.minChunkSize}))throw G(this.chunkSize,{maxChunkSize:this.maxChunkSize,minChunkSize:this.minChunkSize});if(this.maxChunkSize&&(typeof this.maxChunkSize!="number"||this.maxChunkSize<256||this.maxChunkSize%256!==0||this.maxChunkSize<this.chunkSize||this.maxChunkSize<this.minChunkSize))throw new TypeError(`maxChunkSize must be a positive number in multiples of 256, and larger than or equal to both ${this.minChunkSize} and ${this.chunkSize}`);if(this.minChunkSize&&(typeof this.minChunkSize!="number"||this.minChunkSize<256||this.minChunkSize%256!==0||this.minChunkSize>this.chunkSize||this.minChunkSize>this.maxChunkSize))throw new TypeError(`minChunkSize must be a positive number in multiples of 256, and smaller than ${this.chunkSize} and ${this.maxChunkSize}`);if(this.maxFileBytes>0&&this.maxFileBytes<this.file.size)throw new Error(`file size exceeds maximum (${this.file.size} > ${this.maxFileBytes})`);if(this.attempts&&(typeof this.attempts!="number"||this.attempts<=0))throw new TypeError("retries must be a positive number");if(this.delayBeforeAttempt&&(typeof this.delayBeforeAttempt!="number"||this.delayBeforeAttempt<0))throw new TypeError("delayBeforeAttempt must be a positive number")}getEndpoint(){return typeof this.endpoint=="string"?(this.endpointValue=this.endpoint,Promise.resolve(this.endpoint)):this.endpoint(this.file).then(e=>(this.endpointValue=e,this.endpointValue))}async sendChunks(){if(this.ChunkUploaders.length>0&&!(this.player.paused||this.player.offline)){let e=this.ChunkUploaders.pop(),r=await new z(this.eventDispatcher,this.player,this.endpointValue,this.method,await(typeof this.headers=="function"?this.headers():this.headers),this.retryCodes,e.chunk,this.file.size,this.file.type,this.chunkCount,this.chunkSize,this.attempts,this.delayBeforeAttempt,this.totalChunks,this.chunkByteSize).sendChunkWithRetries();this.success&&r&&this.eventDispatcher.dispatch("success")}for(;!(this.success||this.player.paused||this.player.offline);){let e=!1;for(let i=0;i<this.concurrentUploads;i+=1)e||(e=await this.pushUploader());let r=(await Promise.all(this.ChunkUploaders.map(i=>i.sendChunkWithRetries()))).every(i=>i);if(r&&(this.ChunkUploaders=[]),this.success=e,this.success&&r&&this.eventDispatcher.dispatch("success"),!r)return}}async pushUploader(){let{value:e,done:n}=await this.chunkedStreamIterator.next();if(e){let r=new z(this.eventDispatcher,this.player,this.endpointValue,this.method,await(typeof this.headers=="function"?this.headers():this.headers),this.retryCodes,new D(e,this.nextChunkRangeStart),this.file.size,this.file.type,this.chunkCount,this.chunkSize,this.attempts,this.delayBeforeAttempt,this.totalChunks,this.chunkByteSize);this.ChunkUploaders.push(r),this.nextChunkRangeStart+=this.chunkSize,this.chunkCount+=1}return!!n}};function $t(t){return P.createUpload(t)}export{Y as ChunkedStreamIterable,P as UpChunk,$t as createUpload,G as getChunkSizeError,q as isValidChunkSize};
//# sourceMappingURL=upchunk.mjs.map
