var UpChunk=(()=>{var Fe=Object.create;var _=Object.defineProperty;var Me=Object.getOwnPropertyDescriptor;var He=Object.getOwnPropertyNames;var Xe=Object.getPrototypeOf,je=Object.prototype.hasOwnProperty;var T=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),We=(t,e)=>{for(var n in e)_(t,n,{get:e[n],enumerable:!0})},J=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of He(e))!je.call(t,i)&&i!==n&&_(t,i,{get:()=>e[i],enumerable:!(r=Me(e,i))||r.enumerable});return t};var Ve=(t,e,n)=>(n=t!=null?Fe(Xe(t)):{},J(e||!t||!t.__esModule?_(n,"default",{value:t,enumerable:!0}):n,t)),$e=t=>J(_({},"__esModule",{value:!0}),t);var we=T((Nt,Se)=>{var z;typeof window!="undefined"?z=window:typeof global!="undefined"?z=global:typeof self!="undefined"?z=self:z={};Se.exports=z});var Te=T((Ft,Re)=>{Re.exports=dt;var pt=Object.prototype.toString;function dt(t){if(!t)return!1;var e=pt.call(t);return e==="[object Function]"||typeof t=="function"&&e!=="[object RegExp]"||typeof window!="undefined"&&(t===window.setTimeout||t===window.alert||t===window.confirm||t===window.prompt)}});var Pe=T((Mt,ze)=>{var Y=function(t){return t.replace(/^\s+|\s+$/g,"")},ft=function(t){return Object.prototype.toString.call(t)==="[object Array]"};ze.exports=function(t){if(!t)return{};for(var e={},n=Y(t).split(`
`),r=0;r<n.length;r++){var i=n[r],a=i.indexOf(":"),o=Y(i.slice(0,a)).toLowerCase(),s=Y(i.slice(a+1));typeof e[o]=="undefined"?e[o]=s:ft(e[o])?e[o].push(s):e[o]=[e[o],s]}return e}});var Oe=T((Ht,Ae)=>{Ae.exports=bt;var mt=Object.prototype.hasOwnProperty;function bt(){for(var t={},e=0;e<arguments.length;e++){var n=arguments[e];for(var r in n)mt.call(n,r)&&(t[r]=n[r])}return t}});var De=T((Xt,K)=>{"use strict";var _e=we(),gt=Te(),yt=Pe(),Ct=Oe();K.exports=y;K.exports.default=y;y.XMLHttpRequest=_e.XMLHttpRequest||St;y.XDomainRequest="withCredentials"in new y.XMLHttpRequest?y.XMLHttpRequest:_e.XDomainRequest;vt(["get","put","post","patch","head","delete"],function(t){y[t==="delete"?"del":t]=function(e,n,r){return n=Ue(e,n,r),n.method=t.toUpperCase(),Ie(n)}});function vt(t,e){for(var n=0;n<t.length;n++)e(t[n])}function kt(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}function Ue(t,e,n){var r=t;return gt(e)?(n=e,typeof t=="string"&&(r={uri:t})):r=Ct(e,{uri:t}),r.callback=n,r}function y(t,e,n){return e=Ue(t,e,n),Ie(e)}function Ie(t){if(typeof t.callback=="undefined")throw new Error("callback argument missing");var e=!1,n=function(k,O,Ne){e||(e=!0,t.callback(k,O,Ne))};function r(){s.readyState===4&&setTimeout(o,0)}function i(){var l=void 0;if(s.response?l=s.response:l=s.responseText||Et(s),H)try{l=JSON.parse(l)}catch{}return l}function a(l){return clearTimeout(X),l instanceof Error||(l=new Error(""+(l||"Unknown XMLHttpRequest Error"))),l.statusCode=0,n(l,Z)}function o(){if(!h){var l;clearTimeout(X),t.useXDR&&s.status===void 0?l=200:l=s.status===1223?204:s.status;var k=Z,O=null;return l!==0?(k={body:i(),statusCode:l,method:m,headers:{},url:g,rawRequest:s},s.getAllResponseHeaders&&(k.headers=yt(s.getAllResponseHeaders()))):O=new Error("Internal XMLHttpRequest Error"),n(O,k,k.body)}}var s=t.xhr||null;s||(t.cors||t.useXDR?s=new y.XDomainRequest:s=new y.XMLHttpRequest);var u,h,g=s.url=t.uri||t.url,m=s.method=t.method||"GET",v=t.body||t.data,b=s.headers=t.headers||{},A=!!t.sync,H=!1,X,Z={body:void 0,headers:{},statusCode:0,method:m,url:g,rawRequest:s};if("json"in t&&t.json!==!1&&(H=!0,b.accept||b.Accept||(b.Accept="application/json"),m!=="GET"&&m!=="HEAD"&&(b["content-type"]||b["Content-Type"]||(b["Content-Type"]="application/json"),v=JSON.stringify(t.json===!0?v:t.json))),s.onreadystatechange=r,s.onload=o,s.onerror=a,s.onprogress=function(){},s.onabort=function(){h=!0},s.ontimeout=a,s.open(m,g,!A,t.username,t.password),A||(s.withCredentials=!!t.withCredentials),!A&&t.timeout>0&&(X=setTimeout(function(){if(!h){h=!0,s.abort("timeout");var l=new Error("XMLHttpRequest timeout");l.code="ETIMEDOUT",a(l)}},t.timeout)),s.setRequestHeader)for(u in b)b.hasOwnProperty(u)&&s.setRequestHeader(u,b[u]);else if(t.headers&&!kt(t.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in t&&(s.responseType=t.responseType),"beforeSend"in t&&typeof t.beforeSend=="function"&&t.beforeSend(s),s.send(v||null),s}function Et(t){try{if(t.responseType==="document")return t.responseXML;var e=t.responseXML&&t.responseXML.documentElement.nodeName==="parsererror";if(t.responseType===""&&!e)return t.responseXML}catch{}return null}function St(){}});var Ot={};We(Ot,{ChunkedStreamIterable:()=>N,UpChunk:()=>R,createUpload:()=>At,getChunkSizeError:()=>x,isValidChunkSize:()=>B});function G(t,e,...n){if(!t)throw new TypeError(le(e,n))}function le(t,e){let n=0;return t.replace(/%[os]/gu,()=>ce(e[n++]))}function ce(t){return typeof t!="object"||t===null?String(t):Object.prototype.toString.call(t)}var Q;function qe(t){try{let e=t instanceof Error?t:new Error(ce(t));if(Q){Q(e);return}if(typeof dispatchEvent=="function"&&typeof ErrorEvent=="function")dispatchEvent(new ErrorEvent("error",{error:e,message:e.message}));else if(typeof process!="undefined"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)}catch{}}var p=typeof window!="undefined"?window:typeof self!="undefined"?self:typeof global!="undefined"?global:typeof globalThis!="undefined"?globalThis:void 0,ee;var d=class{constructor(e,n){this.code=e,this.message=n}warn(...e){var n;try{if(ee){ee({...this,args:e});return}let r=((n=new Error().stack)!==null&&n!==void 0?n:"").replace(/^(?:.+?\n){2}/gu,`
`);console.warn(this.message,...e,r)}catch{}}},Ge=new d("W01","Unable to initialize event under dispatching."),Ye=new d("W02","Assigning any falsy value to 'cancelBubble' property has no effect."),Ke=new d("W03","Assigning any truthy value to 'returnValue' property has no effect."),Ze=new d("W04","Unable to preventDefault on non-cancelable events."),Je=new d("W05","Unable to preventDefault inside passive event listener invocation."),Qe=new d("W06","An event listener wasn't added because it has been added already: %o, %o"),j=new d("W07","The %o option value was abandoned because the event listener wasn't added as duplicated."),te=new d("W08","The 'callback' argument must be a function or an object that has 'handleEvent' method: %o"),Ut=new d("W09","Event attribute handler must be a function: %o"),f=class{static get NONE(){return ne}static get CAPTURING_PHASE(){return re}static get AT_TARGET(){return ie}static get BUBBLING_PHASE(){return se}constructor(e,n){Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});let r=n!=null?n:{};q.set(this,{type:String(e),bubbles:Boolean(r.bubbles),cancelable:Boolean(r.cancelable),composed:Boolean(r.composed),target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1,inPassiveListenerFlag:!1,dispatchFlag:!1,timeStamp:Date.now()})}get type(){return c(this).type}get target(){return c(this).target}get srcElement(){return c(this).target}get currentTarget(){return c(this).currentTarget}composedPath(){let e=c(this).currentTarget;return e?[e]:[]}get NONE(){return ne}get CAPTURING_PHASE(){return re}get AT_TARGET(){return ie}get BUBBLING_PHASE(){return se}get eventPhase(){return c(this).dispatchFlag?2:0}stopPropagation(){c(this).stopPropagationFlag=!0}get cancelBubble(){return c(this).stopPropagationFlag}set cancelBubble(e){e?c(this).stopPropagationFlag=!0:Ye.warn()}stopImmediatePropagation(){let e=c(this);e.stopPropagationFlag=e.stopImmediatePropagationFlag=!0}get bubbles(){return c(this).bubbles}get cancelable(){return c(this).cancelable}get returnValue(){return!c(this).canceledFlag}set returnValue(e){e?Ke.warn():ae(c(this))}preventDefault(){ae(c(this))}get defaultPrevented(){return c(this).canceledFlag}get composed(){return c(this).composed}get isTrusted(){return!1}get timeStamp(){return c(this).timeStamp}initEvent(e,n=!1,r=!1){let i=c(this);if(i.dispatchFlag){Ge.warn();return}q.set(this,{...i,type:String(e),bubbles:Boolean(n),cancelable:Boolean(r),target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1})}},ne=0,re=1,ie=2,se=3,q=new WeakMap;function c(t,e="this"){let n=q.get(t);return G(n!=null,"'%s' must be an object that Event constructor created, but got another one: %o",e,t),n}function ae(t){if(t.inPassiveListenerFlag){Je.warn();return}if(!t.cancelable){Ze.warn();return}t.canceledFlag=!0}Object.defineProperty(f,"NONE",{enumerable:!0});Object.defineProperty(f,"CAPTURING_PHASE",{enumerable:!0});Object.defineProperty(f,"AT_TARGET",{enumerable:!0});Object.defineProperty(f,"BUBBLING_PHASE",{enumerable:!0});var W=Object.getOwnPropertyNames(f.prototype);for(let t=0;t<W.length;++t)W[t]!=="constructor"&&Object.defineProperty(f.prototype,W[t],{enumerable:!0});typeof p!="undefined"&&typeof p.Event!="undefined"&&Object.setPrototypeOf(f.prototype,p.Event.prototype);function et(t){return p.DOMException?new p.DOMException(t,"InvalidStateError"):(S==null&&(S=class he extends Error{constructor(n){super(n),Error.captureStackTrace&&Error.captureStackTrace(this,he)}get code(){return 11}get name(){return"InvalidStateError"}},Object.defineProperties(S.prototype,{code:{enumerable:!0},name:{enumerable:!0}}),ue(S),ue(S.prototype)),new S(t))}var S,oe={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};function ue(t){let e=Object.keys(oe);for(let n=0;n<e.length;++n){let r=e[n],i=oe[r];Object.defineProperty(t,r,{get(){return i},configurable:!0,enumerable:!0})}}var w=class extends f{static wrap(e){return new(de(e))(e)}constructor(e){super(e.type,{bubbles:e.bubbles,cancelable:e.cancelable,composed:e.composed}),e.cancelBubble&&super.stopPropagation(),e.defaultPrevented&&super.preventDefault(),pe.set(this,{original:e});let n=Object.keys(e);for(let r=0;r<n.length;++r){let i=n[r];i in this||Object.defineProperty(this,i,fe(e,i))}}stopPropagation(){super.stopPropagation();let{original:e}=C(this);"stopPropagation"in e&&e.stopPropagation()}get cancelBubble(){return super.cancelBubble}set cancelBubble(e){super.cancelBubble=e;let{original:n}=C(this);"cancelBubble"in n&&(n.cancelBubble=e)}stopImmediatePropagation(){super.stopImmediatePropagation();let{original:e}=C(this);"stopImmediatePropagation"in e&&e.stopImmediatePropagation()}get returnValue(){return super.returnValue}set returnValue(e){super.returnValue=e;let{original:n}=C(this);"returnValue"in n&&(n.returnValue=e)}preventDefault(){super.preventDefault();let{original:e}=C(this);"preventDefault"in e&&e.preventDefault()}get timeStamp(){let{original:e}=C(this);return"timeStamp"in e?e.timeStamp:super.timeStamp}},pe=new WeakMap;function C(t){let e=pe.get(t);return G(e!=null,"'this' is expected an Event object, but got",t),e}var U=new WeakMap;U.set(Object.prototype,w);typeof p!="undefined"&&typeof p.Event!="undefined"&&U.set(p.Event.prototype,w);function de(t){let e=Object.getPrototypeOf(t);if(e==null)return w;let n=U.get(e);return n==null&&(n=tt(de(e),e),U.set(e,n)),n}function tt(t,e){class n extends t{}let r=Object.keys(e);for(let i=0;i<r.length;++i)Object.defineProperty(n.prototype,r[i],fe(e,r[i]));return n}function fe(t,e){let n=Object.getOwnPropertyDescriptor(t,e);return{get(){let r=C(this).original,i=r[e];return typeof i=="function"?i.bind(r):i},set(r){let i=C(this).original;i[e]=r},configurable:n.configurable,enumerable:n.enumerable}}function nt(t,e,n,r,i,a){return{callback:t,flags:(e?1:0)|(n?2:0)|(r?4:0),signal:i,signalListener:a}}function rt(t){t.flags|=8}function me(t){return(t.flags&1)===1}function be(t){return(t.flags&2)===2}function ge(t){return(t.flags&4)===4}function it(t){return(t.flags&8)===8}function st({callback:t},e,n){try{typeof t=="function"?t.call(e,n):typeof t.handleEvent=="function"&&t.handleEvent(n)}catch(r){qe(r)}}function ye({listeners:t},e,n){for(let r=0;r<t.length;++r)if(t[r].callback===e&&me(t[r])===n)return r;return-1}function at(t,e,n,r,i,a){let o;a&&(o=Ce.bind(null,t,e,n),a.addEventListener("abort",o));let s=nt(e,n,r,i,a,o);return t.cow?(t.cow=!1,t.listeners=[...t.listeners,s]):t.listeners.push(s),s}function Ce(t,e,n){let r=ye(t,e,n);return r!==-1?ve(t,r):!1}function ve(t,e,n=!1){let r=t.listeners[e];return rt(r),r.signal&&r.signal.removeEventListener("abort",r.signalListener),t.cow&&!n?(t.cow=!1,t.listeners=t.listeners.filter((i,a)=>a!==e),!1):(t.listeners.splice(e,1),!0)}function ot(){return Object.create(null)}function ut(t,e){var n;return(n=t[e])!==null&&n!==void 0?n:t[e]={attrCallback:void 0,attrListener:void 0,cow:!1,listeners:[]}}var E=class{constructor(){ke.set(this,ot())}addEventListener(e,n,r){let i=V(this),{callback:a,capture:o,once:s,passive:u,signal:h,type:g}=lt(e,n,r);if(a==null||(h==null?void 0:h.aborted))return;let m=ut(i,g),v=ye(m,a,o);if(v!==-1){ht(m.listeners[v],u,s,h);return}at(m,a,o,u,s,h)}removeEventListener(e,n,r){let i=V(this),{callback:a,capture:o,type:s}=ct(e,n,r),u=i[s];a!=null&&u&&Ce(u,a,o)}dispatchEvent(e){let n=V(this)[String(e.type)];if(n==null)return!0;let r=e instanceof f?e:w.wrap(e),i=c(r,"event");if(i.dispatchFlag)throw et("This event has been in dispatching.");if(i.dispatchFlag=!0,i.target=i.currentTarget=this,!i.stopPropagationFlag){let{cow:a,listeners:o}=n;n.cow=!0;for(let s=0;s<o.length;++s){let u=o[s];if(!it(u)&&(ge(u)&&ve(n,s,!a)&&(s-=1),i.inPassiveListenerFlag=be(u),st(u,this,r),i.inPassiveListenerFlag=!1,i.stopImmediatePropagationFlag))break}a||(n.cow=!1)}return i.target=null,i.currentTarget=null,i.stopImmediatePropagationFlag=!1,i.stopPropagationFlag=!1,i.dispatchFlag=!1,!i.canceledFlag}},ke=new WeakMap;function V(t,e="this"){let n=ke.get(t);return G(n!=null,"'%s' must be an object that EventTarget constructor created, but got another one: %o",e,t),n}function lt(t,e,n){var r;return Ee(e),typeof n=="object"&&n!==null?{type:String(t),callback:e!=null?e:void 0,capture:Boolean(n.capture),passive:Boolean(n.passive),once:Boolean(n.once),signal:(r=n.signal)!==null&&r!==void 0?r:void 0}:{type:String(t),callback:e!=null?e:void 0,capture:Boolean(n),passive:!1,once:!1,signal:void 0}}function ct(t,e,n){return Ee(e),typeof n=="object"&&n!==null?{type:String(t),callback:e!=null?e:void 0,capture:Boolean(n.capture)}:{type:String(t),callback:e!=null?e:void 0,capture:Boolean(n)}}function Ee(t){if(!(typeof t=="function"||typeof t=="object"&&t!==null&&typeof t.handleEvent=="function")){if(t==null||typeof t=="object"){te.warn(t);return}throw new TypeError(le(te.message,[t]))}}function ht(t,e,n,r){Qe.warn(me(t)?"capture":"bubble",t.callback),be(t)!==e&&j.warn("passive"),ge(t)!==n&&j.warn("once"),t.signal!==r&&j.warn("signal")}var $=Object.getOwnPropertyNames(E.prototype);for(let t=0;t<$.length;++t)$[t]!=="constructor"&&Object.defineProperty(E.prototype,$[t],{enumerable:!0});typeof p!="undefined"&&typeof p.EventTarget!="undefined"&&Object.setPrototypeOf(E.prototype,p.EventTarget.prototype);var I=class{constructor(){this.eventTarget=new E}dispatch(e,n){let r=new CustomEvent(e,{detail:n});this.eventTarget.dispatchEvent(r)}};var D=class{constructor(){this.paused=!1,this.offline=!1}};var Le=Ve(De()),wt=[200,201,202,204,308],Rt=[408,502,503,504],Be=(t,e)=>!!t&&wt.includes(t.statusCode),Tt=(t,{retryCodes:e=Rt})=>!t||e.includes(t.statusCode),zt=(t,e)=>e.attemptCount>=e.attempts||!(Be(t)||Tt(t,e)),P=class{constructor(e,n,r,i,a,o,s,u,h,g,m,v,b,A,H){this.eventDispatcher=e;this.player=n;this.endpointValue=r;this.method=i;this.headers=a;this.retryCodes=o;this.chunk=s;this.fileSize=u;this.fileType=h;this.chunkCount=g;this.chunkSize=m;this.attempts=v;this.delayBeforeAttempt=b;this.totalChunks=A;this.chunkByteSize=H;this.attemptCount=0}async sendChunkWithRetries(){let e=async(o,s)=>(this.eventDispatcher.dispatch("chunkSuccess",{chunk:this.chunkCount,chunkSize:this.chunkSize,attempts:this.attemptCount,response:o}),!0),n=async(o,s)=>(this.eventDispatcher.dispatch("error",{message:`Server responded with ${o.statusCode}. Stopping upload.`,chunk:this.chunkCount,attempts:this.attemptCount}),!1),r=async(o,s)=>(this.eventDispatcher.dispatch("attemptFailure",{message:`An error occured uploading chunk ${this.chunkCount}. ${this.attempts-this.attemptCount} retries left.`,chunkNumber:this.chunkCount,attemptsLeft:this.attempts-this.attemptCount}),new Promise(u=>{setTimeout(async()=>{if(this.player.paused||this.player.offline){u(!1);return}let h=await this.sendChunkWithRetries();u(h)},this.delayBeforeAttempt*1e3)})),i;try{this.attemptCount=this.attemptCount+1,i=await this.sendChunk(this.chunk)}catch{}let a={retryCodes:this.retryCodes,attemptCount:this.attemptCount,attempts:this.attempts};return Be(i,a)?e(i,this.chunk):zt(i,a)?n(i,this.chunk):r(i,this.chunk)}async sendChunk(e){let r={...this.headers,"Content-Type":this.fileType,"Content-Range":`bytes ${e.rangeStart}-${e.rangeEnd}/${this.fileSize}`};return this.eventDispatcher.dispatch("attempt",{chunkNumber:this.chunkCount,totalChunks:this.totalChunks,chunkSize:this.chunkSize}),this.xhrPromise({headers:r,url:this.endpointValue,method:this.method,body:e.blob})}xhrPromise(e){let n=r=>{r.upload.onprogress=i=>{var g;let a=this.totalChunks-this.chunkCount,o=(this.fileSize-this.chunk.rangeStart)/this.fileSize/a,s=this.chunk.rangeStart/this.fileSize,h=i.loaded/((g=i.total)!=null?g:this.chunkByteSize)*o;this.eventDispatcher.dispatch("progress",Math.min((s+h)*100,100))}};return new Promise((r,i)=>{this.currentXhr=(0,Le.default)({...e,beforeSend:n},(a,o)=>(this.currentXhr=void 0,a?i(a):r(o)))})}};var L=class{constructor(e,n){this.blob=e;this.rangeStart=n;this.rangeEnd=n+e.size-1}};var xe=30720,F=512e3,M=256,B=(t,{minChunkSize:e=M,maxChunkSize:n=F}={})=>t==null||typeof t=="number"&&t>=256&&t%256===0&&t>=e&&t<=n,x=(t,{minChunkSize:e=M,maxChunkSize:n=F}={})=>new TypeError(`chunkSize ${t} must be a positive number in multiples of 256, between ${e} and ${n}`),N=class{constructor(e,n={}){this.readableStream=e;var r,i,a;if(!B(n.defaultChunkSize,n))throw x(n.defaultChunkSize,n);this.defaultChunkSize=(r=n.defaultChunkSize)!=null?r:xe,this.minChunkSize=(i=n.minChunkSize)!=null?i:M,this.maxChunkSize=(a=n.maxChunkSize)!=null?a:F}get chunkSize(){var e;return(e=this._chunkSize)!=null?e:this.defaultChunkSize}set chunkSize(e){if(!B(e,this))throw x(e,this);this._chunkSize=e}get chunkByteSize(){return this.chunkSize*1024}async*[Symbol.asyncIterator](){let e,n=this.readableStream.getReader();try{for(;;){let{done:r,value:i}=await n.read();if(r){if(e){let o=e;e=void 0,yield o}break}let a=i instanceof Uint8Array?new Blob([i],{type:"application/octet-stream"}):i;for(e=e?new Blob([e,a]):a;e;)if(e.size===this.chunkByteSize){let o=e;e=void 0,yield o;break}else{if(e.size<this.chunkByteSize)break;{let o=e.slice(0,this.chunkByteSize);e=e.slice(this.chunkByteSize),yield o}}}}finally{if(e){let r=e;e=void 0,yield r}n.releaseLock();return}}},Pt=[408,502,503,504],R=class{static createUpload(e){return new R(e)}constructor(e){this.endpoint=e.endpoint,this.file=e.file,this.headers=e.headers||{},this.method=e.method||"PUT",this.attempts=e.attempts||5,this.delayBeforeAttempt=e.delayBeforeAttempt||1,this.retryCodes=e.retryCodes||Pt,this.dynamicChunkSize=e.dynamicChunkSize||!1,this.maxFileBytes=(e.maxFileSize||0)*1024,this.chunkCount=0,this.player=new D,this.success=!1,this.nextChunkRangeStart=0,this.eventDispatcher=new I,this.ChunkUploaders=[],console.log(e.concurrentUploads),this.concurrentUploads=e.concurrentUploads||1,console.log(this.concurrentUploads),this.chunkedStreamIterable=new N(this.file.stream(),{...e,defaultChunkSize:e.chunkSize}),this.chunkedStreamIterator=this.chunkedStreamIterable[Symbol.asyncIterator](),this.totalChunks=Math.ceil(this.file.size/this.chunkByteSize),this.validateOptions(),this.getEndpoint().then(()=>this.sendChunks()),typeof window!="undefined"&&(window.addEventListener("online",()=>{!this.player.offline||(this.player.offline=!1,this.eventDispatcher.dispatch("online"),this.sendChunks())}),window.addEventListener("offline",()=>{this.player.offline=!0,this.eventDispatcher.dispatch("offline")}))}get maxChunkSize(){var e,n;return(n=(e=this.chunkedStreamIterable)==null?void 0:e.maxChunkSize)!=null?n:F}get minChunkSize(){var e,n;return(n=(e=this.chunkedStreamIterable)==null?void 0:e.minChunkSize)!=null?n:M}get chunkSize(){var e,n;return(n=(e=this.chunkedStreamIterable)==null?void 0:e.chunkSize)!=null?n:xe}set chunkSize(e){this.chunkedStreamIterable.chunkSize=e}get chunkByteSize(){return this.chunkedStreamIterable.chunkByteSize}get totalChunkSize(){return Math.ceil(this.file.size/this.chunkByteSize)}on(e,n){this.eventDispatcher.eventTarget.addEventListener(e,n)}once(e,n){this.eventDispatcher.eventTarget.addEventListener(e,n,{once:!0})}off(e,n){this.eventDispatcher.eventTarget.removeEventListener(e,n)}get paused(){return this.player.paused}abort(){this.pause(),this.ChunkUploaders.forEach(e=>{var n;return(n=e.currentXhr)==null?void 0:n.abort()})}pause(){this.player.paused=!0}resume(){this.player.paused&&(this.player.paused=!1,this.sendChunks())}validateOptions(){if(!this.endpoint||typeof this.endpoint!="function"&&typeof this.endpoint!="string")throw new TypeError("endpoint must be defined as a string or a function that returns a promise");if(!(this.file instanceof File))throw new TypeError("file must be a File object");if(this.headers&&typeof this.headers!="function"&&typeof this.headers!="object")throw new TypeError("headers must be null, an object, or a function that returns an object or a promise");if(!B(this.chunkSize,{maxChunkSize:this.maxChunkSize,minChunkSize:this.minChunkSize}))throw x(this.chunkSize,{maxChunkSize:this.maxChunkSize,minChunkSize:this.minChunkSize});if(this.maxChunkSize&&(typeof this.maxChunkSize!="number"||this.maxChunkSize<256||this.maxChunkSize%256!==0||this.maxChunkSize<this.chunkSize||this.maxChunkSize<this.minChunkSize))throw new TypeError(`maxChunkSize must be a positive number in multiples of 256, and larger than or equal to both ${this.minChunkSize} and ${this.chunkSize}`);if(this.minChunkSize&&(typeof this.minChunkSize!="number"||this.minChunkSize<256||this.minChunkSize%256!==0||this.minChunkSize>this.chunkSize||this.minChunkSize>this.maxChunkSize))throw new TypeError(`minChunkSize must be a positive number in multiples of 256, and smaller than ${this.chunkSize} and ${this.maxChunkSize}`);if(this.maxFileBytes>0&&this.maxFileBytes<this.file.size)throw new Error(`file size exceeds maximum (${this.file.size} > ${this.maxFileBytes})`);if(this.attempts&&(typeof this.attempts!="number"||this.attempts<=0))throw new TypeError("retries must be a positive number");if(this.delayBeforeAttempt&&(typeof this.delayBeforeAttempt!="number"||this.delayBeforeAttempt<0))throw new TypeError("delayBeforeAttempt must be a positive number")}getEndpoint(){return typeof this.endpoint=="string"?(this.endpointValue=this.endpoint,Promise.resolve(this.endpoint)):this.endpoint(this.file).then(e=>(this.endpointValue=e,this.endpointValue))}async sendChunks(){if(this.ChunkUploaders.length>0&&!(this.player.paused||this.player.offline)){let e=this.ChunkUploaders.pop(),r=await new P(this.eventDispatcher,this.player,this.endpointValue,this.method,await(typeof this.headers=="function"?this.headers():this.headers),this.retryCodes,e.chunk,this.file.size,this.file.type,this.chunkCount,this.chunkSize,this.attempts,this.delayBeforeAttempt,this.totalChunks,this.chunkByteSize).sendChunkWithRetries();this.success&&r&&this.eventDispatcher.dispatch("success")}for(;!(this.success||this.player.paused||this.player.offline);){let e=!1;console.log(this.concurrentUploads);for(let i=0;i<this.concurrentUploads;i+=1)e||(e=await this.pushUploader());let r=(await Promise.all(this.ChunkUploaders.map(i=>i.sendChunkWithRetries()))).every(i=>i);if(r&&(this.ChunkUploaders=[]),this.success=e,this.success&&r&&this.eventDispatcher.dispatch("success"),!r)return}}async pushUploader(){let{value:e,done:n}=await this.chunkedStreamIterator.next();if(e){let r=new P(this.eventDispatcher,this.player,this.endpointValue,this.method,await(typeof this.headers=="function"?this.headers():this.headers),this.retryCodes,new L(e,this.nextChunkRangeStart),this.file.size,this.file.type,this.chunkCount,this.chunkSize,this.attempts,this.delayBeforeAttempt,this.totalChunks,this.chunkByteSize);this.ChunkUploaders.push(r),this.nextChunkRangeStart+=this.chunkSize,this.chunkCount+=1}return!!n}};function At(t){return R.createUpload(t)}return $e(Ot);})();
//# sourceMappingURL=upchunk.js.map
